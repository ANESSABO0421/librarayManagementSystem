<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body class="flex items-center justify-center h-[100vh] bg-[#10172a]">
    <form
      class="flex flex-col items-center justify-center bg-white shadow-2xl h-[500px] w-[500px] rounded-lg gap-5"
      id="EditForm"
    >
      <h1 class="text-3xl font-bold">Edit Admin</h1>
      <div class="flex">
        <input
          type="text"
          id="name"
          placeholder="enter your name"
          class="border p-2 rounded flex w-[300px]"
        />
      </div>
      <div class="flex">
        <input
          type="email"
          id="email"
          placeholder="enter your email"
          class="border p-2 rounded flex w-[300px]"
        />
      </div>
      <div class="flex">
        <input
          type="text"
          id="phoneNumber"
          placeholder="enter your Phone Number"
          class="border p-2 rounded flex w-[300px]"
        />
      </div>
      <div class="flex">
        <input
          type="password"
          id="password"
          placeholder="enter your password"
          class="border p-2 rounded flex w-[300px]"
        />
      </div>
      <div class="flex">
        <select id="type" class="border w-[300px] rounded-md p-2" disabled>
          <option value="" disabled selected>Who you are</option>
          <option value="User">User</option>
          <option value="Admin">Admin</option>
        </select>
      </div>
      <div class="flex">
        <input type="file" id="images" />
      </div>

      <button
        class="bg-yellow-500 h-[50px] text-white w-[300px] rounded hover:bg-yellow-600 duration-200 ease-in"
      >
        Update
      </button>
    </form>
    <script>
      const url = new URL(window.location.href);
      const id = url.searchParams.get("id");
      // console.log(id)

      // user found and placing all data
      async function loadData() {
        const response = await fetch("http://localhost:5000/getUser");
        const data = await response.json();
        // console.log(data);

        const user = data.find((u) => u._id == id);
        // console.log(user.image);

        if (user) {
          document.getElementById("name").value = user.name;
          document.getElementById("email").value = user.email;
          document.getElementById("phoneNumber").value = user.phoneNumber;
          document.getElementById("password").value = user.password;
          document.getElementById("type").value = user.type;
          // document.getElementById("images").value = user.image.files[0];
        }
      }
      loadData();

      // edit data
      document
        .getElementById("EditForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const name = document.getElementById("name").value;
          const email = document.getElementById("email").value;
          const phoneNumber = document.getElementById("phoneNumber").value;
          const password = document.getElementById("password").value;
          // check
          const imageFile = document.getElementById("images").files[0];
          // FILE CONVERTED TO BASE 64
          const toBase64 = (file) =>
            new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.readAsDataURL(file);
              reader.onload = () => resolve(reader.result);
              reader.onerror = reject;
            });

          //BASE 64 FILE OF IMAGE
          let Base64File = imageFile ? await toBase64(imageFile) : "";

          try {
            let editData = await fetch("http://localhost:5000/update", {
              method: "PUT",
              headers: {
                "content-type": "application/json",
              },
              body: JSON.stringify({
                _id: id,
                name,
                email,
                phoneNumber,
                password,
                // check
                image:Base64File,
              }),
            });
            if (editData) {
              alert("data is updated");
              localStorage.setItem("name:", `${name}`);
              window.location.href = "/adminHome";
            } else {
              alert("data is not updated");
            }
          } catch (error) {
            console.log(error);
          }
        });
    </script>
  </body>
</html>
