<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body
    class="bg-[#10172a] text-white flex items-center justify-center flex-col gap-5"
  >
    <h1 class="text-5xl">Manage Books</h1>
    <div id="main" class="flex flex-col gap-5"></div>
  </body>
  <script>
    const userId = localStorage.getItem("userId");
    async function loadData() {
      const response = await fetch("http://localhost:5000/bookget");
      const data = await response.json();
      // console.log(data)

      //book displaying created by userId
      const user = data.filter((u) => u.createdBy === userId);
      console.log(user);

      let str = "";
      user.map((display) => {
        str += `
    <div class="flex flex-col gap-6 bg-white w-[900px] rounded-2xl shadow-lg p-6 hover:-translate-y-2 duration-300 ease-out">

  <div class="flex items-center justify-center text-gray-900 text-3xl font-extrabold tracking-wide">
    ${display.bookTitle}
  </div>

  <div class="flex justify-between gap-6">

    <div class="flex justify-center items-center w-1/2">
      <img src="${display.image}" 
           class="w-[450px] h-[220px] object-cover rounded-lg shadow-md border border-gray-200" />
    </div>

    <div class="flex flex-col gap-2 w-1/2 text-gray-700 text-base leading-relaxed">
      <p><strong>Book ID:</strong> ${display.bookId}</p>    
      <p><strong>Title:</strong> ${display.bookTitle}</p> 
      <p><strong>Author:</strong> ${display.author}</p>         
      <p><strong>Genre:</strong> ${display.genre}</p>         

      <p class="flex items-center">
        <strong>Status:</strong>
        <span class="${
          display.status === "Borrowed"
            ? "bg-red-100 text-red-700 px-4 py-1 rounded-full ml-3 font-medium shadow-sm"
            : "bg-green-100 text-green-700 px-4 py-1 rounded-full ml-3 font-medium shadow-sm"
        }">
          ${display.status}
        </span>
      </p>
    </div>
  </div>

  <div class="flex gap-5 mt-4">
    <button class="bg-yellow-300 flex-1 text-yellow-700 font-semibold rounded-lg py-2 cursor-pointer hover:bg-yellow-200 transition duration-200 ease-out shadow-sm"
      onclick="goToEdit('${display._id}')">
      Edit
    </button>
    <button class="bg-red-300 flex-1 text-red-600 font-semibold rounded-lg py-2 cursor-pointer hover:bg-red-200 transition duration-200 ease-out shadow-sm"
      onclick="deleteBook('${display._id}')">
      Delete
    </button>
  </div>
</div>

            `;
      });
      document.getElementById("main").innerHTML = str;
    }
    loadData();
    console.log(userId);

    // goto edit page
    function goToEdit(id) {
      window.location.href = `/EditBook?id=${id}`;
    }

    async function deleteBook(id) {
      try {
        const deleteData = await fetch("http://localhost:5000/deleteBook", {
          method: "DELETE",
          headers: {
            "content-type": "application/json",
          },
          body: JSON.stringify({ _id: id }),
        });
        if (deleteData) {
          alert("data is deleted");
          window.location.reload();
        } else {
          alert("data is not deleted");
        }
      } catch (error) {
        console.log(error);
      }
    }
  </script>
</html>
